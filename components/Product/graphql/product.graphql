#import "./_Product.graphql"

query ProductQuery($urlKey: String!) {
    hasCart @client

    products(filter: { url_key: { eq: $urlKey } }, pageSize: 1) {
        items @connection(key: "items") {
            id
            ...Product

            gallery: media_gallery {
                id: url
                label
                url
                type: __typename
            }

            shortDescription: short_description {
                html
            }

            description: description {
                html
            }

            ... on ConfigurableProduct {
                options: configurable_options {
                    id
                    label
                    position
                    # required
                    code: attribute_code
                    items: values {
                        id: value_index
                        label
                        value: value_index
                    }
                }
                variants {
                    attributes {
                        id: value_index
                        code
                        value: value_index
                    }
                    product {
                        id
                        variantSku: sku
                        stock: stock_status

                        price: price_range {
                            minimum: minimum_price {
                                discount {
                                    amountOff: amount_off
                                }
                                regular: regular_price {
                                    value
                                    currency
                                }
                                final: final_price {
                                    value
                                    currency
                                }
                            }
                            maximum: maximum_price {
                                regular: regular_price {
                                    value
                                    currency
                                }
                            }
                        }

                        thumbnail {
                            label
                            url
                        }

                        gallery: media_gallery {
                            id: url
                            label
                            url
                            type: __typename
                        }
                    }
                }
            }
        }
    }
}
